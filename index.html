<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–î–æ–±–∞–≤–∏—Ç—å domain / ip</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    input { margin: 5px 0; padding: 5px; width: 250px; }
    button { padding: 6px 12px; }
    pre { background: #f4f4f4; padding: 10px; }
  </style>
</head>
<body>

<h2>–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å</h2>

<input id="domain" placeholder="domain (example.com)">
<br>
<input id="ip" placeholder="ip (1.1.1.1)">
<br><br>
<button onclick="addEntry()">–î–æ–±–∞–≤–∏—Ç—å</button>

<pre id="status"></pre>

<script>
const TOKEN = "GITHUB_TOKEN";      // üî¥ –≤—Å—Ç–∞–≤—å —Ç–æ–∫–µ–Ω
const OWNER = "USERNAME";          // üî¥ —Ç–≤–æ–π GitHub username
const REPO = "my-repo";            // üî¥ –∏–º—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
const FILE_PATH = "data.txt";      // —Ñ–∞–π–ª –≤ —Ä–µ–ø–æ

async function addEntry() {
  const domain = document.getElementById("domain").value.trim();
  const ip = document.getElementById("ip").value.trim();
  const status = document.getElementById("status");

  if (!domain || !ip) {
    status.textContent = "–ó–∞–ø–æ–ª–Ω–∏ domain –∏ ip";
    return;
  }

  const api = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${FILE_PATH}`;

  try {
    // 1. –ø–æ–ª—É—á–∏—Ç—å —Ñ–∞–π–ª
    const res = await fetch(api, {
      headers: {
        Authorization: `token ${TOKEN}`
      }
    });
    const data = await res.json();

    const content = atob(data.content.replace(/\n/g, ""));
    const newLine = `${domain} ${ip}`;
    const newContent = content + "\n" + newLine;

    // 2. –æ–±–Ω–æ–≤–∏—Ç—å —Ñ–∞–π–ª
    const update = await fetch(api, {
      method: "PUT",
      headers: {
        Authorization: `token ${TOKEN}`,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        message: "add domain",
        content: btoa(newContent),
        sha: data.sha
      })
    });

    if (update.ok) {
      status.textContent = "‚úÖ –ó–∞–ø–∏—Å—å –¥–æ–±–∞–≤–ª–µ–Ω–∞:\n" + newLine;
      document.getElementById("domain").value = "";
      document.getElementById("ip").value = "";
    } else {
      status.textContent = "‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞";
    }

  } catch (e) {
    status.textContent = "‚ùå –û—à–∏–±–∫–∞: " + e;
  }
}
</script>

</body>
</html>
